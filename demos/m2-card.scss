//
// Copyright 2017 Google Inc. All Rights Reserved.
//
// Licensed under the Apache License, Version 2.0 (the "License");
// you may not use this file except in compliance with the License.
// You may obtain a copy of the License at
//
//      http://www.apache.org/licenses/LICENSE-2.0
//
// Unless required by applicable law or agreed to in writing, software
// distributed under the License is distributed on an "AS IS" BASIS,
// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
// See the License for the specific language governing permissions and
// limitations under the License.
//

//
// Imports
//

@import "../packages/mdc-theme/color-palette";

$mdc-theme-secondary: #4285F4; // Google Blue 500

@import "./common";
@import "../packages/mdc-elevation/mdc-elevation";
@import "../packages/mdc-ripple/mdc-ripple";
@import "../packages/mdc-theme/mdc-theme";
@import "../packages/mdc-typography/mdc-typography";

//
// Variables
//

$mdc-card-hairline-border-color-resting: #ddd;
$mdc-card-baseline-background-color: #fff;
$mdc-card-baseline-drop-zone-thickness: 4px;

//
// Mixins
//

@mixin mdc-card-corner-radius($radius) {
  border-radius: $radius;
}

//
// Classes
//

.mdc-card {
  @include mdc-states-base-color(black);
  @include mdc-states-focus-opacity(.08);
  @include mdc-states-hover-opacity(.08);
  @include mdc-states-press-opacity(.08);

  cursor: pointer;
}

.mdc-card--stroked {
  @include mdc-elevation(1);

  border: 1px solid $mdc-card-hairline-border-color-resting;
}

.mdc-drag-collection {
  display: flex;
  flex-direction: row;
  flex-wrap: wrap;

  user-select: none;

  &--dragging {}

  &--single-column {
    // TODO(acdvorak): Is this needed? It causes jank on page load
    flex-direction: column;
  }
}

.mdc-drag-select-disabled {
  user-select: none;
}

// TODO(acdvorak): Prevent native gestures (scrolling and back/forward) in IE/Edge.
.mdc-drag-touch-disabled {
  // Prevents scrolling in IE 11, but ONLY if it's applied to the <body> BEFORE pointerdown :-(
  -ms-touch-action: none;
  touch-action: none;

  // Prevent element hover effects while dragging.
  pointer-events: none;

  // Doesn't seem to prevent scrolling in IE/Edge
  //overflow: hidden;

  // Failed attempt to prevent native back/forward gestures in MS Edge and IE 11
  // https://stackoverflow.com/a/13709150/467582
  //-ms-scroll-chaining: chained;
}

// TODO(acdvorak): Prevent native gestures (scrolling and back/forward) in IE/Edge.
//body {
//  // Prevents scrolling in IE 11, but ONLY if it's applied to the <body> BEFORE pointerdown.
//  -ms-touch-action: none;
//}

.mdc-draggable-item.mdc-draggable-item--clone {
  transition: box-shadow .2s, opacity 0s, transform 0s;
}

.mdc-draggable-item:not(.mdc-draggable-item--clone) {
  transition: box-shadow .2s, opacity 0s, transform .2s;
}

.mdc-draggable-item--source {
  opacity: 0;
}

.mdc-draggable-item--clone {
  position: fixed;
  top: 0;
  left: 0;
  //transition: none;
  pointer-events: none;
}

.mdc-drop-spacer {
  flex-grow: 0;
  flex-shrink: 1;

  // TODO(acdvorak): Figure out why this hack is needed to force the element to consume width
  //border: 1px solid transparent;

  // TODO(acdvorak): Document that `width` is set dynamically in JS
}

.mdc-drop-indicator {
  background-color: #333;
  border-radius: 4px;
  width: $mdc-card-baseline-drop-zone-thickness;

  .mdc-drag-collection--single-column & {
    width: unset;
    height: $mdc-card-baseline-drop-zone-thickness;
  }
}

//
// Demo
//

$demo-card-size: 150px;
$demo-card-margin: 8px;
$demo-card-cols: 3;
$demo-drop-zone-thickness: 6px;

// TODO(acdvorak): How should clients calculate this, and how do we make it dynamic so cards can be added/removed?
@function demo-card-collection-primary-axis-size($num-cols) {
  $card-total-margin: $demo-card-margin * 2;
  $card-total-width: $demo-card-size + $card-total-margin;
  @return ($card-total-width * $num-cols) + $demo-drop-zone-thickness;
}

.hero {
  position: relative;
  flex-direction: row;
  flex-wrap: wrap;
  height: unset;
  padding: 48px;
}

.demo-card-collection-group {
  display: flex;
  flex-direction: row;
  flex-wrap: wrap;
  justify-content: center;
  justify-items: center;
}

.demo-card-collection-wrapper {
  display: flex;
  flex-direction: column;
  align-content: center;
  align-items: center;
  margin: 0 48px 48px 48px;
}

.demo-card-collection-heading {
  margin-top: 0;
  margin-left: $demo-card-margin;
  margin-right: $demo-card-margin;
  text-align: center;
}

.demo-card-collection {
  // TODO(acdvorak): Can we dynamically add the extra width needed to accommodate the drop target?
  // Or should drop target be absolutely positioned in <body> instead of in the list?
  // TODO(acdvorak): Document the need for extra width to accommodate the drop zone
  // TODO(acdvorak): Add test cases for all width variations
  max-width: demo-card-collection-primary-axis-size($demo-card-cols);
}

.demo-card-collection--single-column {
  // TODO(acdvorak): Can we dynamically add the extra height needed to accommodate the drop target?
  // Or should drop target be absolutely positioned in <body> instead of in the list?
  max-width: demo-card-collection-primary-axis-size(1);
  height: demo-card-collection-primary-axis-size(3);
}

.demo-card-collection .mdc-drop-indicator {
  width: $demo-drop-zone-thickness;
  margin: $demo-card-margin 0;
}

.mdc-drag-collection--single-column .mdc-drop-indicator {
  width: unset;
  height: $demo-drop-zone-thickness;
  margin: 0 $demo-card-margin;
}

.demo-card {
  @include mdc-elevation(4);
  @include mdc-card-corner-radius(4px);
  @include mdc-typography(display2);

  background-color: $mdc-card-baseline-background-color;

  display: flex;
  align-content: center;
  align-items: center;
  justify-content: center;
  justify-items: center;

  margin: $demo-card-margin;

  width: $demo-card-size;
  height: $demo-card-size;
}

.demo-card.mdc-draggable-item--source,
.demo-card.mdc-draggable-item--clone {
  @include mdc-elevation(10);
}

.demo-card--color {
  $color-value: mdc-theme-prop-value(secondary);

  @include mdc-states-base-color(white);
  @include mdc-states-focus-opacity(.14);
  @include mdc-states-hover-opacity(.14);
  @include mdc-states-press-opacity(.14);

  background-color: $color-value;
  color: white;
}
